rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    /* ================= Helpers ================= */

    function isSignedIn() {
      return request.auth != null;
    }

    function isAdmin() {
      return isSignedIn() &&
        (request.auth.token.role == 'admin' ||
         request.auth.token.role == 'root');
    }

    /* ================= Inmobiliarias =================
       Estructura esperada:
       /inmobiliarias/{inmobiliariaId}/
         â”œâ”€â”€ logo.png
         â””â”€â”€ backgrounds/
             â”œâ”€â”€ primary.jpg
             â”œâ”€â”€ secondary.jpg
             â””â”€â”€ tertiary.jpg
    */

    match /inmobiliarias/{inmobiliariaId}/{allPaths=**} {

      // ğŸ”“ Lectura pÃºblica (logos, fondos, branding pÃºblico)
      allow read: if true;

      // ğŸ” Escritura solo admin / root
      allow write: if isAdmin();
    }

    /* ================= Fallback ================= */

    // âŒ Bloqueo total fuera de paths permitidos
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
